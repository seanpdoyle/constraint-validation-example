<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Add Users and require Authentication for messaging
</title>
    <link href="../../stylesheets/site.css" rel="stylesheet" />
    <script src="../../javascripts/site.js"></script>
  </head>
  <body class="page">
    <header class="header">
      <h1 class="header__name">
<a href="../../">          constraint-validation-example
</a>      </h1>


      <nav class="
        header__navigation
        navigation
        
      ">
<a href="../3fb4b2762304c6772e6fb83a4b4fc0b79981bfa9/">              &#8592; Previous
</a>
<a href="../4c76dc815a68739452c5b60eaae905dc39bfd39a/">              Next &#8594;
</a>      </nav>
    </header>

    <main class="content">
      <details class="accordion content__item">
        <summary class="accordion__summary">
          <div class="accordion__closed">
            <nav class="
              commit-history
              u-db-overflow-y--auto
              u-mb-overflow-x--scroll
            ">
                <a href="../5545fe8a221966fb48731709f57604458683afee/" class="commit-node commit-node--collapsed" title="[SKIP]: Create `git-read` GitHub Action
"></a>
                <a href="../848b575b23dd386b8dae7baaf0b6917248626c8c/" class="commit-node commit-node--collapsed" title="[GENERATED]: Initial Commit
"></a>
                <a href="../8514a28f2ae814bf83126ee296e74d75ecac774d/" class="commit-node commit-node--collapsed" title="[GENERATED]: Install ActiveStorage and ActionText
"></a>
                <a href="../aa205e258c1c81cf66e11af84c30fcbef4a671c8/" class="commit-node commit-node--collapsed" title="[GENERATED]: Webpacker support for Typescript
"></a>
                <a href="../5979fc333df3332acd92434898d83e878c8df8ef/" class="commit-node commit-node--collapsed" title="[SKIP]: Install TailwindCSS
"></a>
                <a href="../6c02ab3a95d59cfbe7db9d17fc4cd741a1169754/" class="commit-node commit-node--collapsed" title="Explain the project in the README.md"></a>
                <a href="../b84a43ef9166c315e0d9007e8f1c2eeaba520145/" class="commit-node commit-node--collapsed" title="Store invalid submission parameters in the Flash
"></a>
                <a href="../3fb4b2762304c6772e6fb83a4b4fc0b79981bfa9/" class="commit-node commit-node--collapsed" title="Add System tests for Validation Messages A11y
"></a>
                <a href="./" class="commit-node commit-node--collapsed" title="Add Users and require Authentication for messaging
" aria-current="page"></a>
                <a href="../4c76dc815a68739452c5b60eaae905dc39bfd39a/" class="commit-node commit-node--collapsed" title="ActionView::Helpers::FormBuilder extensions
"></a>
                <a href="../e7dcacb69eafefd590576ea283dde744230dd7d1/" class="commit-node commit-node--collapsed" title="Abstract how fields reference validation messages
"></a>
                <a href="../e0b3ccf54edeef33bab1bf6912fa21a78e7bdcf7/" class="commit-node commit-node--collapsed" title="Abstract Validation Message ID generation
"></a>
                <a href="../951bb63c88105d76e7f8570cb3880c432b0a4d61/" class="commit-node commit-node--collapsed" title="Abstract Validation Message rendering
"></a>
                <a href="../43a623bca8ea84e063e3056d642d6712972780cc/" class="commit-node commit-node--collapsed" title="Integrate with Browser Constraint Validation API
"></a>
                <a href="../cabc045344543ccabd6876ac541f5761c1206ed2/" class="commit-node commit-node--collapsed" title="Validation message from server
"></a>
                <a href="../db7ee42b83a4319a2c07eb32dd3cc1bb7cbcc765/" class="commit-node commit-node--collapsed" title="Dynamically disable invalid form submit buttons
"></a>
                <a href="../47ba0e492c16836c9ab639188d6cdaafd4bebd1c/" class="commit-node commit-node--collapsed" title="Style with TailwindCSS
"></a>
            </nav>

            <div class="accordion__toggle">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Expand History</title>
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Expand History</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>

          <div class="accordion__opened">
            <div class="accordion__toggle accordion__toggle--fill">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 010 .708L5.707 8l5.647 5.646a.5.5 0 01-.708.708l-6-6a.5.5 0 010-.708l6-6a.5.5 0 01.708 0z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>
        </summary>

        <nav class="
          commit-history
          commit-history--full
          u-db-overflow-y--auto
          u-mb-overflow-x--scroll
        ">
<a href="../5545fe8a221966fb48731709f57604458683afee/" class="commit-node commit-node--full">              <p>[SKIP]: Create <code>git-read</code> GitHub Action</p>

</a><a href="../848b575b23dd386b8dae7baaf0b6917248626c8c/" class="commit-node commit-node--full">              <p>[GENERATED]: Initial Commit</p>

</a><a href="../8514a28f2ae814bf83126ee296e74d75ecac774d/" class="commit-node commit-node--full">              <p>[GENERATED]: Install ActiveStorage and ActionText</p>

</a><a href="../aa205e258c1c81cf66e11af84c30fcbef4a671c8/" class="commit-node commit-node--full">              <p>[GENERATED]: Webpacker support for Typescript</p>

</a><a href="../5979fc333df3332acd92434898d83e878c8df8ef/" class="commit-node commit-node--full">              <p>[SKIP]: Install TailwindCSS</p>

</a><a href="../6c02ab3a95d59cfbe7db9d17fc4cd741a1169754/" class="commit-node commit-node--full">              <p>Explain the project in the README.md</p>

</a><a href="../b84a43ef9166c315e0d9007e8f1c2eeaba520145/" class="commit-node commit-node--full">              <p>Store invalid submission parameters in the Flash</p>

</a><a href="../3fb4b2762304c6772e6fb83a4b4fc0b79981bfa9/" class="commit-node commit-node--full">              <p>Add System tests for Validation Messages A11y</p>

</a><a href="./" class="commit-node commit-node--full" aria-current="page">              <p>Add Users and require Authentication for messaging</p>

</a><a href="../4c76dc815a68739452c5b60eaae905dc39bfd39a/" class="commit-node commit-node--full">              <p>ActionView::Helpers::FormBuilder extensions</p>

</a><a href="../e7dcacb69eafefd590576ea283dde744230dd7d1/" class="commit-node commit-node--full">              <p>Abstract how fields reference validation messages</p>

</a><a href="../e0b3ccf54edeef33bab1bf6912fa21a78e7bdcf7/" class="commit-node commit-node--full">              <p>Abstract Validation Message ID generation</p>

</a><a href="../951bb63c88105d76e7f8570cb3880c432b0a4d61/" class="commit-node commit-node--full">              <p>Abstract Validation Message rendering</p>

</a><a href="../43a623bca8ea84e063e3056d642d6712972780cc/" class="commit-node commit-node--full">              <p>Integrate with Browser Constraint Validation API</p>

</a><a href="../cabc045344543ccabd6876ac541f5761c1206ed2/" class="commit-node commit-node--full">              <p>Validation message from server</p>

</a><a href="../db7ee42b83a4319a2c07eb32dd3cc1bb7cbcc765/" class="commit-node commit-node--full">              <p>Dynamically disable invalid form submit buttons</p>

</a><a href="../47ba0e492c16836c9ab639188d6cdaafd4bebd1c/" class="commit-node commit-node--full">              <p>Style with TailwindCSS</p>

</a>        </nav>
      </details>

      <article class="
        commit-content
        commit-content--double
        content__item
        content__item--grow
      ">
        <section class="commit commit--message">

          <h1 id="add-users-and-require-authentication-for-messaging">Add Users and require Authentication for messaging</h1>

<h2 id="users">Users</h2>

<p>In order to increase the variety of validations and form styles in this
example application, introduce the concept of a User, and require that
they be authenticated to create Messages.</p>

<p>When creating <code>Message</code> records through the <code>MessagesController</code>,
associate the new messages with the Current user.</p>

<p>Fixtures are declared for existing <code>User</code> and <code>Message</code> records to both
simplify writing the authentication tests <em>and</em> so that we can delay a
sign up process until a later point in the process.</p>

<h2 id="authentications">Authentications</h2>

<p>To authenticate the User, rely on <code>has_secure_password</code>, the <code>bcrypt</code>
gem, and <code>ActionDispatch</code>&lsquo;s session. The <code>AuthenticationsController</code> is
responsible for creating, verifying, and destroying User sessions.
Matching <code>before_action</code> declarations are declared in both
<code>AuthenticationsController</code> and <code>MessagesController</code> to ensure that the
proper authentications have occurred before certain actions.</p>

<h2 id="validations">Validations</h2>

<p>In a <em>very</em> similar style to the <code>Message</code> record validations, declare
<code>Authentication</code> validations for each individual field. Additionally, to
demonstrate a more secure authentication process, when an invalid
username &amp; password pairing are submitted, don&rsquo;t mark the fields
themselves as invalid, but instead associate the error message to the
record itself.</p>

<p>Note that we&rsquo;re asserting that the username and password fields are
<em>described by</em> the error message (which relies on <code>aria-describedby</code>),
and not that they&rsquo;re <em>validation errors</em> themselves (which rely on the
browser-native <a href="https://developer.mozilla.org/en-US/docs/Web/API/ValidityState">Constraint Validation validity state</a>).</p>

<h2 id="duplications">Duplications</h2>

<p>At this point in the process, we have two controllers and two forms.
There are some emerging patterns, mostly related to rendering the
correct ARIA attributes, and testing form elements&rsquo; Accessibility.</p>

        </section>

          <aside class="commit commit--diff commit--long-content">
              <details
  id="Gemfile"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse Gemfile</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand Gemfile</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      Gemfile
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/Gemfile b/Gemfile
index 910c8ef..b6451e0 100644
</span><span class="gd">--- a/Gemfile
</span><span class="gi">+++ b/Gemfile
</span><span class="p">@@ -21,7 +21,7 @@</span> gem 'jbuilder', '~&gt; 2.7'
 # Use Redis adapter to run Action Cable in production
 # gem 'redis', '~&gt; 4.0'
 # Use Active Model has_secure_password
<span class="gd">-# gem 'bcrypt', '~&gt; 3.1.7'
</span><span class="gi">+gem 'bcrypt', '~&gt; 3.1.7'
</span> 
 # Use Active Storage variant
 # gem 'image_processing', '~&gt; 1.2'
</code></pre></div></details>

              <details
  id="Gemfile.lock"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse Gemfile.lock</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand Gemfile.lock</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      Gemfile.lock
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/Gemfile.lock b/Gemfile.lock
index 92a2727..0e4ad44 100644
</span><span class="gd">--- a/Gemfile.lock
</span><span class="gi">+++ b/Gemfile.lock
</span><span class="p">@@ -122,6 +122,7 @@</span> GEM
       railties (&gt;= 4.0)
     addressable (2.7.0)
       public_suffix (&gt;= 2.0.2, &lt; 5.0)
<span class="gi">+    bcrypt (3.1.13)
</span>     bindex (0.8.1)
     bootsnap (1.4.8)
       msgpack (~&gt; 1.0)
<span class="p">@@ -232,6 +233,7 @@</span> PLATFORMS
 
 DEPENDENCIES
   activerecord-session_store
<span class="gi">+  bcrypt (~&gt; 3.1.7)
</span>   bootsnap (&gt;= 1.4.4)
   byebug
   capybara (&gt;= 3.26)
</code></pre></div></details>

              <details
  id="app/controllers/application_controller.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/controllers/application_controller.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/controllers/application_controller.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/controllers/application_controller.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/controllers/application_controller.rb b/app/controllers/application_controller.rb
index 6242faf..9ebbc14 100644
</span><span class="gd">--- a/app/controllers/application_controller.rb
</span><span class="gi">+++ b/app/controllers/application_controller.rb
</span><span class="p">@@ -1,3 +1,5 @@</span>
 class ApplicationController &lt; ActionController::Base
   include FlashParams
<span class="gi">+
+  before_action { Current.user = Authentication.find(session) }
</span> end
</code></pre></div></details>

              <details
  id="app/controllers/authentications_controller.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/controllers/authentications_controller.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/controllers/authentications_controller.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/controllers/authentications_controller.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/controllers/authentications_controller.rb b/app/controllers/authentications_controller.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..545f6a5
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/controllers/authentications_controller.rb
</span><span class="p">@@ -0,0 +1,32 @@</span>
<span class="gi">+class AuthenticationsController &lt; ApplicationController
+  before_action(only: :new) { redirect_to messages_url if Current.user }
+
+  def new
+    authentication = Authentication.restore_submission(authentications_params)
+
+    render locals: { authentication: authentication }
+  end
+
+  def create
+    authentication = Authentication.new(authentications_params)
+    authentication.session = session
+
+    if authentication.save
+      redirect_to messages_url
+    else
+      redirect_to new_authentication_url, params: { authentication: authentications_params.except(:password) }
+    end
+  end
+
+  def destroy
+    authentication = Authentication.new(session: session)
+
+    authentication.destroy
+
+    redirect_back fallback_location: messages_url
+  end
+
+  def authentications_params
+    params.fetch(:authentication, {}).permit(:username, :password)
+  end
+end
</span></code></pre></div></details>

              <details
  id="app/controllers/messages_controller.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/controllers/messages_controller.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/controllers/messages_controller.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/controllers/messages_controller.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/controllers/messages_controller.rb b/app/controllers/messages_controller.rb
index 27fd30a..9dbec88 100644
</span><span class="gd">--- a/app/controllers/messages_controller.rb
</span><span class="gi">+++ b/app/controllers/messages_controller.rb
</span><span class="p">@@ -1,6 +1,8 @@</span>
 class MessagesController &lt; ApplicationController
<span class="gi">+  before_action(except: :index) { head :forbidden unless Current.user }
+
</span>   def create
<span class="gd">-    message = Message.new(message_params)
</span><span class="gi">+    message = Current.user.messages.new(message_params)
</span> 
     if message.save
       redirect_to messages_url
<span class="p">@@ -10,7 +12,7 @@</span> class MessagesController &lt; ApplicationController
   end
 
   def index
<span class="gd">-    messages = Message.all
</span><span class="gi">+    messages = Message.all.order(:created_at).with_rich_text_content
</span>     message = Message.restore_submission(message_params)
 
     render locals: { messages: messages, message: message }
</code></pre></div></details>

              <details
  id="app/models/authentication.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/models/authentication.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/models/authentication.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/models/authentication.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/models/authentication.rb b/app/models/authentication.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..6fb6e80
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/models/authentication.rb
</span><span class="p">@@ -0,0 +1,35 @@</span>
<span class="gi">+class Authentication
+  include ActiveModel::Model
+  include ActiveModel::Attributes
+  include Restorable
+
+  attribute :username, :string
+  attribute :password, :string
+  attribute :session
+
+  validates :username, presence: true
+  validates :password, presence: true
+  validate { errors.add(:base, :invalid) unless user.present? }
+
+  def self.find(session)
+    if (user_id = session[:user_id])
+      User.find_by(id: user_id).tap { |user| session.delete(:user_id) if user.nil? }
+    end
+  end
+
+  def user
+    if (user = User.find_by(username: username)) &amp;&amp; user.authenticate_password(password)
+      user
+    end
+  end
+
+  def save
+    if valid?
+      session[:user_id] = user.id
+    end
+  end
+
+  def destroy
+    session.delete(:user_id)
+  end
+end
</span></code></pre></div></details>

              <details
  id="app/models/current.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/models/current.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/models/current.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/models/current.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/models/current.rb b/app/models/current.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..73a9744
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/models/current.rb
</span><span class="p">@@ -0,0 +1,3 @@</span>
<span class="gi">+class Current &lt; ActiveSupport::CurrentAttributes
+  attribute :user
+end
</span></code></pre></div></details>

              <details
  id="app/models/message.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/models/message.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/models/message.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/models/message.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/models/message.rb b/app/models/message.rb
index 1ed7734..be736b2 100644
</span><span class="gd">--- a/app/models/message.rb
</span><span class="gi">+++ b/app/models/message.rb
</span><span class="p">@@ -1,4 +1,5 @@</span>
 class Message &lt; ApplicationRecord
<span class="gi">+  belongs_to :user
</span>   has_rich_text :content
 
   validates :content, presence: true
</code></pre></div></details>

              <details
  id="app/models/user.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/models/user.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/models/user.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/models/user.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/models/user.rb b/app/models/user.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..0f72fbf
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/models/user.rb
</span><span class="p">@@ -0,0 +1,5 @@</span>
<span class="gi">+class User &lt; ApplicationRecord
+  has_secure_password
+
+  has_many :messages
+end
</span></code></pre></div></details>

              <details
  id="app/views/authentications/new.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/authentications/new.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/authentications/new.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/authentications/new.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/authentications/new.html.erb b/app/views/authentications/new.html.erb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..22fe7fd
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/views/authentications/new.html.erb
</span><span class="p">@@ -0,0 +1,31 @@</span>
<span class="gi">+&lt;%= form_with(model: authentication) do |form| %&gt;
+  &lt;% form.object.errors[:base].tap do |errors| %&gt;
+    &lt;% if errors.any? %&gt;
+      &lt;%= tag.span errors.to_sentence, aria: { live: "assertive" } %&gt;
+    &lt;% end %&gt;
+  &lt;% end %&gt;
+
+  &lt;% form.object.errors[:username].tap do |errors| %&gt;
+    &lt;%= form.label :username %&gt;
+    &lt;%= form.text_field :username, aria: {
+      describedby: {authentication_username_validation_message: errors.any?},
+      invalid: errors.any?
+    } %&gt;
+    &lt;% if errors.any? %&gt;
+      &lt;%= tag.span errors.to_sentence, id: :authentication_username_validation_message %&gt;
+    &lt;% end %&gt;
+  &lt;% end %&gt;
+
+  &lt;% form.object.errors[:password].tap do |errors| %&gt;
+    &lt;%= form.label :password %&gt;
+    &lt;%= form.password_field :password, aria: {
+      describedby: {authentication_password_validation_message: errors.any?},
+      invalid: errors.any?
+    } %&gt;
+    &lt;% if errors.any? %&gt;
+      &lt;%= tag.span errors.to_sentence, id: :authentication_password_validation_message %&gt;
+    &lt;% end %&gt;
+  &lt;% end %&gt;
+
+  &lt;%= form.button %&gt;
+&lt;% end %&gt;
</span></code></pre></div></details>

              <details
  id="app/views/messages/index.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/messages/index.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/messages/index.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/messages/index.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/messages/index.html.erb b/app/views/messages/index.html.erb
index 4f44a89..6d89e9c 100644
</span><span class="gd">--- a/app/views/messages/index.html.erb
</span><span class="gi">+++ b/app/views/messages/index.html.erb
</span><span class="p">@@ -4,17 +4,27 @@</span>
   &lt;% end %&gt;
 &lt;/ul&gt;
 
<span class="gd">-&lt;%= form_with model: message do |form| %&gt;
-  &lt;% form.object.errors[:content].tap do |errors| %&gt;
-    &lt;%= form.label :content %&gt;
-    &lt;%= form.rich_text_area :content, aria: {
-      describedby: {message_content_validation_message: errors.any?},
-      invalid: errors.any?
-    } %&gt;
-    &lt;% if errors.any? %&gt;
-      &lt;%= tag.span errors.to_sentence, id: :message_content_validation_message %&gt;
</span><span class="gi">+&lt;% if Current.user %&gt;
+  &lt;%= form_with model: message do |form| %&gt;
+    &lt;% form.object.errors[:content].tap do |errors| %&gt;
+      &lt;%= form.label :content %&gt;
+      &lt;%= form.rich_text_area :content, aria: {
+        describedby: {message_content_validation_message: errors.any?},
+        invalid: errors.any?
+      } %&gt;
+      &lt;% if errors.any? %&gt;
+        &lt;%= tag.span errors.to_sentence, id: :message_content_validation_message %&gt;
+      &lt;% end %&gt;
</span>     &lt;% end %&gt;
<span class="gi">+
+    &lt;%= form.button %&gt;
</span>   &lt;% end %&gt;
 
<span class="gd">-  &lt;%= form.button %&gt;
</span><span class="gi">+  &lt;%= button_to authentication_path, method: :delete do %&gt;
+    Log out
+  &lt;% end %&gt;
+&lt;% else %&gt;
+  &lt;%= link_to new_authentication_path do %&gt;
+    Log in to send a message
+  &lt;% end %&gt;
</span> &lt;% end %&gt;
</code></pre></div></details>

              <details
  id="bin/setup"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse bin/setup</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand bin/setup</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      bin/setup
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/bin/setup b/bin/setup
index 90700ac..5b66c83 100755
</span><span class="gd">--- a/bin/setup
</span><span class="gi">+++ b/bin/setup
</span><span class="p">@@ -26,7 +26,7 @@</span> FileUtils.chdir APP_ROOT do
   # end
 
   puts "\n== Preparing database =="
<span class="gd">-  system! 'bin/rails db:prepare'
</span><span class="gi">+  system! 'bin/rails db:prepare db:fixtures:load'
</span> 
   puts "\n== Removing old logs and tempfiles =="
   system! 'bin/rails log:clear tmp:clear'
</code></pre></div></details>

              <details
  id="config/locales/en.yml"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse config/locales/en.yml</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand config/locales/en.yml</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      config/locales/en.yml
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config/locales/en.yml b/config/locales/en.yml
index a56856b..4b4e89b 100644
</span><span class="gd">--- a/config/locales/en.yml
</span><span class="gi">+++ b/config/locales/en.yml
</span><span class="p">@@ -32,8 +32,13 @@</span>
 en:
   helpers:
     label:
<span class="gi">+      authentication:
+        username: "Username"
+        password: "Password"
</span>       message:
         content: "Content"
     submit:
<span class="gi">+      authentication:
+        create: "Log in"
</span>       message:
         create: "Send"
</code></pre></div></details>

              <details
  id="config/routes.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse config/routes.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand config/routes.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      config/routes.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config/routes.rb b/config/routes.rb
index 37345a4..e7b857e 100644
</span><span class="gd">--- a/config/routes.rb
</span><span class="gi">+++ b/config/routes.rb
</span><span class="p">@@ -1,6 +1,8 @@</span>
 Rails.application.routes.draw do
   # For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html
   resources :messages, only: [:index, :create]
<span class="gi">+  resources :authentications, only: [:new, :create]
+  resource :authentication, only: :destroy
</span> 
   root to: redirect("/messages")
 end
</code></pre></div></details>

              <details
  id="db/migrate/20201004040718_create_users.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse db/migrate/20201004040718_create_users.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand db/migrate/20201004040718_create_users.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      db/migrate/20201004040718_create_users.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/db/migrate/20201004040718_create_users.rb b/db/migrate/20201004040718_create_users.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..4710f5f
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/db/migrate/20201004040718_create_users.rb
</span><span class="p">@@ -0,0 +1,12 @@</span>
<span class="gi">+class CreateUsers &lt; ActiveRecord::Migration[6.1]
+  def change
+    create_table :users do |t|
+      t.text :username, null: false
+      t.text :password_digest, null: false
+
+      t.timestamps
+
+      t.index :username
+    end
+  end
+end
</span></code></pre></div></details>

              <details
  id="db/migrate/20201004041613_add_user_to_messages.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse db/migrate/20201004041613_add_user_to_messages.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand db/migrate/20201004041613_add_user_to_messages.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      db/migrate/20201004041613_add_user_to_messages.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/db/migrate/20201004041613_add_user_to_messages.rb b/db/migrate/20201004041613_add_user_to_messages.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..b71d80a
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/db/migrate/20201004041613_add_user_to_messages.rb
</span><span class="p">@@ -0,0 +1,5 @@</span>
<span class="gi">+class AddUserToMessages &lt; ActiveRecord::Migration[6.1]
+  def change
+    add_reference :messages, :user, null: false, foreign_key: true, index: true
+  end
+end
</span></code></pre></div></details>

              <details
  id="db/schema.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse db/schema.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand db/schema.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      db/schema.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/db/schema.rb b/db/schema.rb
index 8fd5890..65fdfb1 100644
</span><span class="gd">--- a/db/schema.rb
</span><span class="gi">+++ b/db/schema.rb
</span><span class="p">@@ -10,7 +10,7 @@</span>
 #
 # It's strongly recommended that you check this file into your version control system.
 
<span class="gd">-ActiveRecord::Schema.define(version: 2020_10_04_015757) do
</span><span class="gi">+ActiveRecord::Schema.define(version: 2020_10_04_041613) do
</span> 
   # These are extensions that must be enabled in order to support this database
   enable_extension "plpgsql"
<span class="p">@@ -56,6 +56,8 @@</span> ActiveRecord::Schema.define(version: 2020_10_04_015757) do
   create_table "messages", force: :cascade do |t|
     t.datetime "created_at", precision: 6, null: false
     t.datetime "updated_at", precision: 6, null: false
<span class="gi">+    t.bigint "user_id", null: false
+    t.index ["user_id"], name: "index_messages_on_user_id"
</span>   end
 
   create_table "sessions", force: :cascade do |t|
<span class="p">@@ -67,6 +69,15 @@</span> ActiveRecord::Schema.define(version: 2020_10_04_015757) do
     t.index ["updated_at"], name: "index_sessions_on_updated_at"
   end
 
<span class="gi">+  create_table "users", force: :cascade do |t|
+    t.text "username", null: false
+    t.text "password_digest", null: false
+    t.datetime "created_at", precision: 6, null: false
+    t.datetime "updated_at", precision: 6, null: false
+    t.index ["username"], name: "index_users_on_username"
+  end
+
</span>   add_foreign_key "active_storage_attachments", "active_storage_blobs", column: "blob_id"
   add_foreign_key "active_storage_variant_records", "active_storage_blobs", column: "blob_id"
<span class="gi">+  add_foreign_key "messages", "users"
</span> end
</code></pre></div></details>

              <details
  id="test/application_system_test_case.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/application_system_test_case.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/application_system_test_case.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/application_system_test_case.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/application_system_test_case.rb b/test/application_system_test_case.rb
index 78287d7..0271970 100644
</span><span class="gd">--- a/test/application_system_test_case.rb
</span><span class="gi">+++ b/test/application_system_test_case.rb
</span><span class="p">@@ -6,4 +6,25 @@</span> class ApplicationSystemTestCase &lt; ActionDispatch::SystemTestCase
   Capybara.modify_selector(:rich_text_area) do
     filter_set(:capybara_accessible_selectors, %i[focused fieldset described_by validation_error])
   end
<span class="gi">+
+  private
+    def sign_in_as(user)
+      username =
+        case user when Symbol then users(user).username
+        else user.username
+        end
+
+      visit new_authentication_path
+      fill_in label(:authentication, :username), with: username
+      fill_in label(:authentication, :password), with: "password"
+      click_on submit(:authentication)
+    end
+
+    def label(i18n_key, attribute)
+      I18n.translate(attribute, scope: [:helpers, :label, i18n_key])
+    end
+
+    def submit(i18n_key)
+      I18n.translate(:create, scope: [:helpers, :submit, i18n_key])
+    end
</span> end
</code></pre></div></details>

              <details
  id="test/controllers/authentications_controller_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/controllers/authentications_controller_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/controllers/authentications_controller_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/controllers/authentications_controller_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/controllers/authentications_controller_test.rb b/test/controllers/authentications_controller_test.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..659e9bf
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/controllers/authentications_controller_test.rb
</span><span class="p">@@ -0,0 +1,65 @@</span>
<span class="gi">+require "test_helper"
+
+class AuthenticationsControllerTest &lt; ActionDispatch::IntegrationTest
+  test "#new redirects to messages#index when already authenticated" do
+    sign_in_as :alice
+    get new_authentication_path
+
+    assert_redirected_to messages_url
+  end
+
+  test "#create with a valid username/password pairing writes to the session" do
+    alice = users(:alice)
+
+    sign_in_as alice
+
+    assert_redirected_to messages_url
+    assert_equal alice.id, session[:user_id]
+  end
+
+  test "#create with empty fields redirects with errors" do
+    alice = users(:alice)
+
+    post authentications_path, params: {
+      authentication: {
+        username: "",
+        password: "",
+      }
+    }
+
+    assert_redirected_to(new_authentication_url).then { follow_redirect! }
+    assert_flash_params({ authentication: { username: "" } })
+    assert_nil session[:user_id]
+    assert_select "#authentication_username_validation_message", text: "can't be blank"
+    assert_select %(input[type="text"][aria-invalid="true"][aria-describedby~="authentication_username_validation_message"])
+    assert_select "#authentication_password_validation_message", text: "can't be blank"
+    assert_select %(input[type="password"][aria-invalid="true"][aria-describedby~="authentication_password_validation_message"])
+  end
+
+  test "#create with an invalid username/password pairing redirects with errors" do
+    alice = users(:alice)
+
+    post authentications_path, params: {
+      authentication: {
+        username: alice.username,
+        password: "junk",
+      }
+    }
+
+    assert_redirected_to(new_authentication_url).then { follow_redirect! }
+    assert_flash_params({ authentication: { username: alice.username } })
+    assert_nil session[:user_id]
+    assert_select %(span[aria-live="assertive"]), text: "is invalid"
+    assert_select %(input[type="text"][value="#{alice.username}"])
+    assert_select %(input[type="password"]:not([value]))
+  end
+
+  test "#destroy logs the User out" do
+    sign_in_as :alice
+
+    delete authentication_path
+
+    assert_redirected_to messages_url
+    assert_nil session[:user_id]
+  end
+end
</span></code></pre></div></details>

              <details
  id="test/controllers/messages_controller_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/controllers/messages_controller_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/controllers/messages_controller_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/controllers/messages_controller_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/controllers/messages_controller_test.rb b/test/controllers/messages_controller_test.rb
index 0c8edf8..7b91666 100644
</span><span class="gd">--- a/test/controllers/messages_controller_test.rb
</span><span class="gi">+++ b/test/controllers/messages_controller_test.rb
</span><span class="p">@@ -2,6 +2,7 @@</span> require "test_helper"
 
 class MessagesControllerTest &lt; ActionDispatch::IntegrationTest
   test "#create with invalid parameters redirects to the new action" do
<span class="gi">+    sign_in_as :alice
</span>     post messages_path, params: {
       message: { content: "" }
     }
<span class="p">@@ -11,6 +12,7 @@</span> class MessagesControllerTest &lt; ActionDispatch::IntegrationTest
   end
 
   test "#create clears parameters once successful" do
<span class="gi">+    sign_in_as :alice
</span>     post messages_path, params: {
       message: { content: "" }
     }
<span class="p">@@ -26,7 +28,16 @@</span> class MessagesControllerTest &lt; ActionDispatch::IntegrationTest
     end
   end
 
<span class="gd">-  test "#index through a direct request renders a fresh Message form" do
</span><span class="gi">+  test "#index when unauthenticated links to the log in page" do
+    get messages_path
+
+    assert_response :success
+    assert_select "trix-editor", count: 0
+    assert_select %(a[href="#{new_authentication_path}"])
+  end
+
+  test "#index through a direct authenticated request renders a fresh Message form" do
+    sign_in_as :alice
</span>     get messages_path
 
     assert_response :success
<span class="p">@@ -35,6 +46,7 @@</span> class MessagesControllerTest &lt; ActionDispatch::IntegrationTest
   end
 
   test "#index when redirected with invalid parameters renders errors" do
<span class="gi">+    sign_in_as :alice
</span>     post messages_path, params: {
       message: { content: "" }
     }
<span class="p">@@ -43,13 +55,4 @@</span> class MessagesControllerTest &lt; ActionDispatch::IntegrationTest
     assert_select "#message_content_validation_message", "can't be blank"
     assert_select %{trix-editor[aria-invalid="true"][aria-describedby~="message_content_validation_message"]}
   end
<span class="gd">-
-  private
-    def assert_flash_params(params)
-      values_from_flash = flash[:params].slice(*params.keys)
-
-      assert_equal \
-        params.with_indifferent_access,
-        values_from_flash.with_indifferent_access
-    end
</span> end
</code></pre></div></details>

              <details
  id="test/fixtures/action_text/rich_texts.yml"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/fixtures/action_text/rich_texts.yml</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/fixtures/action_text/rich_texts.yml</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/fixtures/action_text/rich_texts.yml
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/fixtures/action_text/rich_texts.yml b/test/fixtures/action_text/rich_texts.yml
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..a39967e
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/fixtures/action_text/rich_texts.yml
</span><span class="p">@@ -0,0 +1,12 @@</span>
<span class="gi">+DEFAULTS: &amp;DEFAULTS
+  record: $LABEL (Message)
+
+alice_hello_bob:
+  &lt;&lt;: *DEFAULTS
+  name: content
+  body: &lt;div&gt;Hello, Bob&lt;/div&gt;
+
+bob_hello_alice:
+  &lt;&lt;: *DEFAULTS
+  name: content
+  body: &lt;div&gt;Hello, Alice&lt;/div&gt;
</span></code></pre></div></details>

              <details
  id="test/fixtures/messages.yml"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/fixtures/messages.yml</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/fixtures/messages.yml</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/fixtures/messages.yml
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/fixtures/messages.yml b/test/fixtures/messages.yml
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..56ffaa6
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/fixtures/messages.yml
</span><span class="p">@@ -0,0 +1,7 @@</span>
<span class="gi">+alice_hello_bob:
+  created_at: &lt;%= 5.minutes.ago %&gt;
+  user: alice
+
+bob_hello_alice:
+  created_at: &lt;%= 10.minutes.ago %&gt;
+  user: bob
</span></code></pre></div></details>

              <details
  id="test/fixtures/users.yml"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/fixtures/users.yml</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/fixtures/users.yml</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/fixtures/users.yml
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/fixtures/users.yml b/test/fixtures/users.yml
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..bfde22d
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/fixtures/users.yml
</span><span class="p">@@ -0,0 +1,9 @@</span>
<span class="gi">+DEFAULTS: &amp;DEFAULTS
+  username: $LABEL
+  password_digest: &lt;%= BCrypt::Password.create("password") %&gt;
+
+alice:
+  &lt;&lt;: *DEFAULTS
+
+bob:
+  &lt;&lt;: *DEFAULTS
</span></code></pre></div></details>

              <details
  id="test/models/authentication_test.rb"
  
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/models/authentication_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/models/authentication_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/models/authentication_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/models/authentication_test.rb b/test/models/authentication_test.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..33ca5dd
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/models/authentication_test.rb
</span><span class="p">@@ -0,0 +1,101 @@</span>
<span class="gi">+require "test_helper"
+
+class AuthenticationTest &lt; ActiveSupport::TestCase
+  test ".find when the session has an invalid user_id returns nil" do
+    session = { user_id: 0 }
+
+    user = Authentication.find(session)
+
+    assert_nil user
+  end
+
+  test ".find when the session is missing a user_id returns nil" do
+    session = {}
+
+    user = Authentication.find(session)
+
+    assert_nil user
+  end
+
+  test ".find retrieves the User matching user_id" do
+    alice = users(:alice)
+    session = { user_id: alice.id }
+
+    user = Authentication.find(session)
+
+    assert_equal alice, user
+  end
+
+  test "invalid when username is blank" do
+    authentication = Authentication.new(username: "")
+
+    valid = authentication.validate
+
+    assert_not valid
+    assert_includes authentication.errors, :username
+  end
+
+  test "invalid when password is blank" do
+    authentication = Authentication.new(password: "")
+
+    valid = authentication.validate
+
+    assert_not valid
+    assert_includes authentication.errors, :password
+  end
+
+  test "invalid when User does not exist" do
+    authentication = Authentication.new(username: "junk", password: "junk")
+
+    valid = authentication.validate
+
+    assert_not valid
+    assert_includes authentication.errors, :base
+  end
+
+  test "invalid when username and password pairing are incorrect" do
+    alice = users(:alice)
+    authentication = Authentication.new(username: alice.username, password: "junk")
+
+    valid = authentication.validate
+
+    assert_not valid
+    assert_includes authentication.errors, :base
+  end
+
+  test "#save does not write to the Session when invalid" do
+    session = {}
+    authentication = Authentication.new(session: session)
+
+    saved = authentication.save
+
+    assert_not saved
+    assert_not_empty authentication.errors
+    assert_empty session
+  end
+
+  test "#save writes to the Session" do
+    alice = users(:alice)
+    session = {}
+    authentication = Authentication.new(
+      username: alice.username,
+      password: "password",
+      session: session
+    )
+
+    saved = authentication.save
+
+    assert saved
+    assert_empty authentication.errors
+    assert_equal alice.id, session[:user_id]
+  end
+
+  test "#destroy removes the user_id from the session" do
+    session = { user_id: 1 }
+    authentication = Authentication.new(session: session)
+
+    authentication.destroy
+
+    assert_empty session
+  end
+end
</span></code></pre></div></details>

              <details
  id="test/system/authentications_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/system/authentications_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/system/authentications_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/system/authentications_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/system/authentications_test.rb b/test/system/authentications_test.rb
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..c7aa586
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/test/system/authentications_test.rb
</span><span class="p">@@ -0,0 +1,11 @@</span>
<span class="gi">+require "application_system_test_case"
+
+class AuthenticationsTest &lt; ApplicationSystemTestCase
+  test "invalid authentication renders errors" do
+    visit new_authentication_path
+    click_on submit(:authentication)
+
+    assert_field label(:authentication, :username), described_by: "can't be blank"
+    assert_field label(:authentication, :password), described_by: "can't be blank"
+  end
+end
</span></code></pre></div></details>

              <details
  id="test/system/messages_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/system/messages_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/system/messages_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/system/messages_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/system/messages_test.rb b/test/system/messages_test.rb
index f005327..f59e32c 100644
</span><span class="gd">--- a/test/system/messages_test.rb
</span><span class="gi">+++ b/test/system/messages_test.rb
</span><span class="p">@@ -2,7 +2,7 @@</span> require "application_system_test_case"
 
 class MessagesTest &lt; ApplicationSystemTestCase
   test "invalid messages are rendered as :invalid" do
<span class="gd">-    visit messages_path
</span><span class="gi">+    sign_in_as :alice
</span>     fill_in_rich_text_area label(:message, :content), with: ""
     click_on submit(:message)
 
<span class="p">@@ -13,12 +13,4 @@</span> class MessagesTest &lt; ApplicationSystemTestCase
     def assert_rich_text_area(locator, **options)
       assert_selector :rich_text_area, locator, **options
     end
<span class="gd">-
-    def label(i18n_key, attribute)
-      I18n.translate(attribute, scope: [:helpers, :label, i18n_key])
-    end
-
-    def submit(i18n_key)
-      I18n.translate(:create, scope: [:helpers, :submit, i18n_key])
-    end
</span> end
</code></pre></div></details>

              <details
  id="test/test_helper.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/test_helper.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/test_helper.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/test_helper.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/test_helper.rb b/test/test_helper.rb
index 47b598d..c2795d2 100644
</span><span class="gd">--- a/test/test_helper.rb
</span><span class="gi">+++ b/test/test_helper.rb
</span><span class="p">@@ -11,3 +11,29 @@</span> class ActiveSupport::TestCase
 
   # Add more helper methods to be used by all tests here...
 end
<span class="gi">+
+class ActionDispatch::IntegrationTest
+  private
+
+  def sign_in_as(user)
+    username =
+      case user when Symbol then users(user).username
+      else user.username
+      end
+
+    post authentications_path, params: {
+      authentication: {
+        username: username,
+        password: "password"
+      }
+    }
+  end
+
+  def assert_flash_params(params)
+    values_from_flash = flash[:params].slice(*params.keys)
+
+    assert_equal \
+      params.with_indifferent_access,
+      values_from_flash.with_indifferent_access
+  end
+end
</span></code></pre></div></details>

          </aside>
      </article>
    </main>
  </body>
</html>
