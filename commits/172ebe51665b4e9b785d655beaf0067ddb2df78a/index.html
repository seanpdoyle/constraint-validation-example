<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Dynamically disable invalid form submit buttons
</title>
    <link href="../../stylesheets/site.css" rel="stylesheet" />
    <script src="../../javascripts/site.js"></script>
  </head>
  <body class="page">
    <header class="header">
      <h1 class="header__name">
<a href="../../">          constraint-validation-example
</a>      </h1>


      <nav class="
        header__navigation
        navigation
        
      ">
<a href="../cabc045344543ccabd6876ac541f5761c1206ed2/">              &#8592; Previous
</a>
<a href="../a02146627ee5892c5ec7530ae7f88a95c8e7743a/">              Next &#8594;
</a>      </nav>
    </header>

    <main class="content">
      <details class="accordion content__item">
        <summary class="accordion__summary">
          <div class="accordion__closed">
            <nav class="
              commit-history
              u-db-overflow-y--auto
              u-mb-overflow-x--scroll
            ">
                <a href="../5545fe8a221966fb48731709f57604458683afee/" class="commit-node commit-node--collapsed" title="[SKIP]: Create `git-read` GitHub Action
"></a>
                <a href="../848b575b23dd386b8dae7baaf0b6917248626c8c/" class="commit-node commit-node--collapsed" title="[GENERATED]: Initial Commit
"></a>
                <a href="../8514a28f2ae814bf83126ee296e74d75ecac774d/" class="commit-node commit-node--collapsed" title="[GENERATED]: Install ActiveStorage and ActionText
"></a>
                <a href="../aa205e258c1c81cf66e11af84c30fcbef4a671c8/" class="commit-node commit-node--collapsed" title="[GENERATED]: Webpacker support for Typescript
"></a>
                <a href="../5979fc333df3332acd92434898d83e878c8df8ef/" class="commit-node commit-node--collapsed" title="[SKIP]: Install TailwindCSS
"></a>
                <a href="../6c02ab3a95d59cfbe7db9d17fc4cd741a1169754/" class="commit-node commit-node--collapsed" title="Explain the project in the README.md"></a>
                <a href="../b84a43ef9166c315e0d9007e8f1c2eeaba520145/" class="commit-node commit-node--collapsed" title="Store invalid submission parameters in the Flash
"></a>
                <a href="../3fb4b2762304c6772e6fb83a4b4fc0b79981bfa9/" class="commit-node commit-node--collapsed" title="Add System tests for Validation Messages A11y
"></a>
                <a href="../5fa1d1117ab87280d9bcd5d03851c5dd9c520982/" class="commit-node commit-node--collapsed" title="Add Users and require Authentication for messaging
"></a>
                <a href="../4c76dc815a68739452c5b60eaae905dc39bfd39a/" class="commit-node commit-node--collapsed" title="ActionView::Helpers::FormBuilder extensions
"></a>
                <a href="../e7dcacb69eafefd590576ea283dde744230dd7d1/" class="commit-node commit-node--collapsed" title="Abstract how fields reference validation messages
"></a>
                <a href="../e0b3ccf54edeef33bab1bf6912fa21a78e7bdcf7/" class="commit-node commit-node--collapsed" title="Abstract Validation Message ID generation
"></a>
                <a href="../951bb63c88105d76e7f8570cb3880c432b0a4d61/" class="commit-node commit-node--collapsed" title="Abstract Validation Message rendering
"></a>
                <a href="../43a623bca8ea84e063e3056d642d6712972780cc/" class="commit-node commit-node--collapsed" title="Integrate with Browser Constraint Validation API
"></a>
                <a href="../cabc045344543ccabd6876ac541f5761c1206ed2/" class="commit-node commit-node--collapsed" title="Validation message from server
"></a>
                <a href="./" class="commit-node commit-node--collapsed" title="Dynamically disable invalid form submit buttons
" aria-current="page"></a>
                <a href="../a02146627ee5892c5ec7530ae7f88a95c8e7743a/" class="commit-node commit-node--collapsed" title="Style with TailwindCSS
"></a>
            </nav>

            <div class="accordion__toggle">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Expand History</title>
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Expand History</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>

          <div class="accordion__opened">
            <div class="accordion__toggle accordion__toggle--fill">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 010 .708L5.707 8l5.647 5.646a.5.5 0 01-.708.708l-6-6a.5.5 0 010-.708l6-6a.5.5 0 01.708 0z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>
        </summary>

        <nav class="
          commit-history
          commit-history--full
          u-db-overflow-y--auto
          u-mb-overflow-x--scroll
        ">
<a href="../5545fe8a221966fb48731709f57604458683afee/" class="commit-node commit-node--full">              <p>[SKIP]: Create <code>git-read</code> GitHub Action</p>

</a><a href="../848b575b23dd386b8dae7baaf0b6917248626c8c/" class="commit-node commit-node--full">              <p>[GENERATED]: Initial Commit</p>

</a><a href="../8514a28f2ae814bf83126ee296e74d75ecac774d/" class="commit-node commit-node--full">              <p>[GENERATED]: Install ActiveStorage and ActionText</p>

</a><a href="../aa205e258c1c81cf66e11af84c30fcbef4a671c8/" class="commit-node commit-node--full">              <p>[GENERATED]: Webpacker support for Typescript</p>

</a><a href="../5979fc333df3332acd92434898d83e878c8df8ef/" class="commit-node commit-node--full">              <p>[SKIP]: Install TailwindCSS</p>

</a><a href="../6c02ab3a95d59cfbe7db9d17fc4cd741a1169754/" class="commit-node commit-node--full">              <p>Explain the project in the README.md</p>

</a><a href="../b84a43ef9166c315e0d9007e8f1c2eeaba520145/" class="commit-node commit-node--full">              <p>Store invalid submission parameters in the Flash</p>

</a><a href="../3fb4b2762304c6772e6fb83a4b4fc0b79981bfa9/" class="commit-node commit-node--full">              <p>Add System tests for Validation Messages A11y</p>

</a><a href="../5fa1d1117ab87280d9bcd5d03851c5dd9c520982/" class="commit-node commit-node--full">              <p>Add Users and require Authentication for messaging</p>

</a><a href="../4c76dc815a68739452c5b60eaae905dc39bfd39a/" class="commit-node commit-node--full">              <p>ActionView::Helpers::FormBuilder extensions</p>

</a><a href="../e7dcacb69eafefd590576ea283dde744230dd7d1/" class="commit-node commit-node--full">              <p>Abstract how fields reference validation messages</p>

</a><a href="../e0b3ccf54edeef33bab1bf6912fa21a78e7bdcf7/" class="commit-node commit-node--full">              <p>Abstract Validation Message ID generation</p>

</a><a href="../951bb63c88105d76e7f8570cb3880c432b0a4d61/" class="commit-node commit-node--full">              <p>Abstract Validation Message rendering</p>

</a><a href="../43a623bca8ea84e063e3056d642d6712972780cc/" class="commit-node commit-node--full">              <p>Integrate with Browser Constraint Validation API</p>

</a><a href="../cabc045344543ccabd6876ac541f5761c1206ed2/" class="commit-node commit-node--full">              <p>Validation message from server</p>

</a><a href="./" class="commit-node commit-node--full" aria-current="page">              <p>Dynamically disable invalid form submit buttons</p>

</a><a href="../a02146627ee5892c5ec7530ae7f88a95c8e7743a/" class="commit-node commit-node--full">              <p>Style with TailwindCSS</p>

</a>        </nav>
      </details>

      <article class="
        commit-content
        commit-content--double
        content__item
        content__item--grow
      ">
        <section class="commit commit--message">

          <h1 id="dynamically-disable-invalid-form-submit-buttons">Dynamically disable invalid form submit buttons</h1>

<p>When an <code>invalid</code> event fires, set all of element&rsquo;s related <code>&lt;form&gt;</code>
submit buttons to <code>[disabled]</code>. In this case, a &ldquo;submit&rdquo; button is an
<code>&lt;input type=&quot;submit&quot;&gt;</code>, a <code>&lt;button type=&quot;submit&quot;&gt;</code>, or a <code>&lt;button&gt;</code>
element that does not declare a <code>[type]</code> attribute.</p>

<p>When the <code>blur</code> event fires for a valid field, update the <code>&lt;form&gt;</code>
element&rsquo;s submit buttons based on whether or not <em>all</em> of the <code>&lt;form&gt;</code> s
fields are valid. In this case, a form is &ldquo;valid&rdquo; if every element&rsquo;s
<code>ValidityState.valid == true</code>. This property is dynamically updated by
the browser outside of the <code>checkValidity()</code> and <code>reportValidity()</code>
interface updating methods.</p>

<p>Similarly, when an <code>input</code> event fires, update the <code>&lt;form&gt;</code> element&rsquo;s
submit buttons based on its &ldquo;validity&rdquo;.</p>

        </section>

          <aside class="commit commit--diff commit--long-content">
              <details
  id="app/javascript/initializers/turbo.ts"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/javascript/initializers/turbo.ts</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/javascript/initializers/turbo.ts</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/javascript/initializers/turbo.ts
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/javascript/initializers/turbo.ts b/app/javascript/initializers/turbo.ts
index 48ff64e..94ea449 100644
</span><span class="gd">--- a/app/javascript/initializers/turbo.ts
</span><span class="gi">+++ b/app/javascript/initializers/turbo.ts
</span><span class="p">@@ -6,6 +6,8 @@</span> type FieldElement =
   HTMLSelectElement |
   HTMLTextAreaElement
 
<span class="gi">+type SubmitElement = HTMLButtonElement | HTMLInputElement
+
</span> addEventListener("invalid", (event) =&gt; {
   if (isFieldElement(event.target)) {
     reportValidity(event.target)
<span class="p">@@ -23,9 +25,17 @@</span> addEventListener("focusout", ({ target }) =&gt; {
   }
 })
 
<span class="gi">+addEventListener("input", ({ target }) =&gt; {
+  if (isFieldElement(target)) {
+    disableSubmit(target.form)
+  }
+})
+
</span> function clearValidity(input: FieldElement): void {
   input.setCustomValidity("")
 
<span class="gi">+  if (input.form) disableSubmit(input.form)
+
</span>   reportValidity(input)
 }
 
<span class="p">@@ -51,9 +61,19 @@</span> function reportValidity(input: FieldElement): void {
     if (!element.parentElement) {
       input.parentElement.append(element)
     }
<span class="gi">+
+    if (input.form) disableSubmit(input.form)
</span>   }
 }
 
<span class="gi">+function disableSubmit(form: HTMLFormElement): void {
+  const submitButtons = Array.from(form.querySelectorAll('[type="submit"], button:not([type])')).filter(isSubmitElement)
+  const fields = Array.from(form.elements).filter(isFieldElement)
+  const isValid = fields.every(input =&gt; input.validity.valid)
+
+  for (const submitButton of submitButtons) submitButton.disabled = !isValid
+}
+
</span> function createValidationMessageFragment(form) {
   if (form) {
     const template = form.querySelector("[data-validation-message-template]")
<span class="p">@@ -88,3 +108,7 @@</span> function isFieldElement(element: any): element is FieldElement {
     HTMLTextAreaElement,
   ].some(field =&gt; element instanceof field)
 }
<span class="gi">+
+function isSubmitElement(element: any): element is SubmitElement {
+  return [ HTMLButtonElement, HTMLInputElement ].some(field =&gt; element instanceof field)
+}
</span></code></pre></div></details>

              <details
  id="test/system/authentications_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/system/authentications_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/system/authentications_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/system/authentications_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/system/authentications_test.rb b/test/system/authentications_test.rb
index a6ff627..bdbe707 100644
</span><span class="gd">--- a/test/system/authentications_test.rb
</span><span class="gi">+++ b/test/system/authentications_test.rb
</span><span class="p">@@ -1,10 +1,21 @@</span>
 require "application_system_test_case"
 
 class AuthenticationsTest &lt; ApplicationSystemTestCase
<span class="gi">+  test "valid authentication enables the submit button" do
+    alice = users(:alice)
+
+    visit new_authentication_path
+    fill_in label(:authentication, :username), with: alice.username
+    fill_in label(:authentication, :password), with: "password"
+
+    assert_button submit(:authentication), disabled: false
+  end
+
</span>   test "invalid authentication renders errors" do
     visit new_authentication_path
     click_on submit(:authentication)
 
<span class="gi">+    assert_button submit(:authentication), disabled: true
</span>     assert_field label(:authentication, :username), validation_error: "can't be blank"
     assert_field label(:authentication, :password), validation_error: "can't be blank"
   end
<span class="p">@@ -15,6 +26,7 @@</span> class AuthenticationsTest &lt; ApplicationSystemTestCase
     fill_in label(:authentication, :username), with: "junk"
     fill_in label(:authentication, :password), with: ""
 
<span class="gi">+    assert_button submit(:authentication), disabled: true
</span>     assert_field label(:authentication, :username), valid: true
     assert_field label(:authentication, :password), validation_error: "can't be blank"
     assert_no_field label(:authentication, :username), validation_error: "can't be blank"
<span class="p">@@ -23,8 +35,9 @@</span> class AuthenticationsTest &lt; ApplicationSystemTestCase
   test "invalid authentication falls back to in-Browser validation messages" do
     visit new_authentication_path
     fill_in label(:authentication, :password), with: "junk"
<span class="gd">-    click_on submit(:authentication)
</span><span class="gi">+    fill_in label(:authentication, :username), with: ""
</span> 
<span class="gi">+    assert_button submit(:authentication), disabled: true
</span>     assert_field label(:authentication, :password), validation_error: "Please lengthen this text to 7 characters or more (you are currently using 4 characters)."
   end
 end
</code></pre></div></details>

          </aside>
      </article>
    </main>
  </body>
</html>
